{
  "name": "HackerHardware WAF Rules",
  "version": "1.0",
  "description": "Web Application Firewall rules for edge protection",
  "rules": [
    {
      "id": "block_sql_injection",
      "description": "Block SQL injection attempts",
      "enabled": true,
      "action": "block",
      "expression": "(http.request.uri.query contains \"' OR 1=1\" or http.request.uri.query contains \"UNION SELECT\" or http.request.uri.query contains \"DROP TABLE\")"
    },
    {
      "id": "block_xss",
      "description": "Block XSS attack patterns",
      "enabled": true,
      "action": "block",
      "expression": "(http.request.uri.query contains \"<script\" or http.request.uri.query contains \"javascript:\" or http.request.uri.query contains \"onerror=\")"
    },
    {
      "id": "block_path_traversal",
      "description": "Block path traversal attempts",
      "enabled": true,
      "action": "block",
      "expression": "(http.request.uri.path contains \"../\" or http.request.uri.path contains \"..\\\")"
    },
    {
      "id": "rate_limit_api",
      "description": "Rate limit API endpoints",
      "enabled": true,
      "action": "challenge",
      "expression": "(http.request.uri.path contains \"/api/\" and rate(10m) > 1000)"
    },
    {
      "id": "block_bad_bots",
      "description": "Block known bad user agents",
      "enabled": true,
      "action": "block",
      "expression": "(http.user_agent contains \"sqlmap\" or http.user_agent contains \"nikto\" or http.user_agent contains \"masscan\")"
    },
    {
      "id": "challenge_suspicious_countries",
      "description": "Challenge requests from high-risk countries",
      "enabled": false,
      "action": "challenge",
      "expression": "(ip.geoip.country in {\"XX\" \"YY\" \"ZZ\"})"
    },
    {
      "id": "block_large_payloads",
      "description": "Block unusually large request bodies",
      "enabled": true,
      "action": "block",
      "expression": "(http.request.body.size > 10485760)"
    },
    {
      "id": "require_https",
      "description": "Enforce HTTPS connections",
      "enabled": true,
      "action": "redirect",
      "expression": "(http.request.scheme != \"https\")"
    },
    {
      "id": "block_shell_injection",
      "description": "Block shell command injection",
      "enabled": true,
      "action": "block",
      "expression": "(http.request.uri.query contains \"; ls\" or http.request.uri.query contains \"| cat\" or http.request.uri.query contains \"&& whoami\")"
    },
    {
      "id": "challenge_missing_user_agent",
      "description": "Challenge requests without user agent",
      "enabled": true,
      "action": "challenge",
      "expression": "(not http.user_agent)"
    },
    {
      "id": "block_dotfiles",
      "description": "Block access to dotfiles",
      "enabled": true,
      "action": "block",
      "expression": "(http.request.uri.path contains \"/.env\" or http.request.uri.path contains \"/.git\" or http.request.uri.path matches \".*/\\..*\")"
    },
    {
      "id": "allow_health_checks",
      "description": "Always allow health check endpoints",
      "enabled": true,
      "action": "allow",
      "expression": "(http.request.uri.path eq \"/healthz\" or http.request.uri.path eq \"/api/v1/healthz\")"
    }
  ],
  "rate_limits": {
    "global": {
      "requests_per_minute": 1000,
      "burst": 100
    },
    "api": {
      "requests_per_minute": 100,
      "burst": 20
    },
    "auth": {
      "requests_per_minute": 10,
      "burst": 5
    }
  },
  "ip_lists": {
    "allowlist": {
      "description": "Trusted IP addresses",
      "ips": []
    },
    "blocklist": {
      "description": "Blocked IP addresses",
      "ips": []
    }
  }
}
